% ===========================
% Packages
% ===========================

% --- Core Setup for Modern LaTeX (XeLaTeX or LuaLaTeX REQUIRED) ---
\usepackage{fontspec}                % REQUIRED for \newfontfamily and modern font handling with Xe/LuaLaTeX
\usepackage{amsmath}                 % AMS Math packages
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsthm}                  % For theorem-like environments (if you use them)

% Load packages that modify page layout or fundamental definitions BEFORE polyglossia/bidi
\usepackage{fancyhdr}                % Fancy headers and footers
\usepackage[Glenn]{fncychap}         % Fancy chapter headers
\usepackage{titlesec}                % Custom section titles

\usepackage{polyglossia}             % Multiple language support
\setdefaultlanguage{english}         % Set default language to English
\setotherlanguage{arabic}            % Set secondary language to Arabic
\newfontfamily\arabicfont[Script=Arabic]{Amiri} % Arabic font

% Font and Formatting
\usepackage{lmodern}                 % Latin Modern fonts
\usepackage{romannum}                % Roman numeral support
\usepackage{indentfirst}             % Indent first paragraph
\usepackage{extsizes}                % Extended sizes for fonts

% Graphics and Colors
\usepackage{graphicx}                % Enhanced graphics support
\usepackage{xcolor}  
% ===================== PACKAGES ======================
 % For \sectionfont and \subsectionfont% Enhanced color support
\usepackage{subcaption}              % Modern subfigure support
\usepackage[table]{xcolor}           % Color support for tables

% Hyperlinks
\usepackage{hyperref}                % Hyperlink support
\hypersetup{
  colorlinks = true,                 % Enable colored links
  urlcolor = black,                   % URL color
  linkcolor = black,                  % Link color
  citecolor = black                   % Citation color
}

% Tables
\usepackage{tabularx}                % Extra features for tabular environment
\usepackage{array}                   % Array and tabular environments
\usepackage{booktabs}                % Enhancements for tabular
\usepackage{multirow}                % Multi-row support
\usepackage{tabu}                    % Flexible tabular support

% Floating elements
\usepackage{float}                   % Enhanced floating support
\usepackage{wrapfig}                 % Wrap text around figures

% Captions
\usepackage{caption}                 % Customisation of captions

% Algorithm
\usepackage[ruled,vlined,linesnumbered,commentsnumbered]{algorithm2e} % <<--- ADDED THIS LINE

% Glossaries and Acronyms
\usepackage[acronym, automake]{glossaries} % Glossaries and acronyms support
\makeglossaries

% Bibliography
\usepackage[backend=biber,sorting=none]{biblatex} % Bibliography support
\addbibresource{bibliography/references.bib}      % Path to the bibliography file

% Lists
\usepackage{listofitems}             % Handling lists of items

% Diagrams and Plots
\usepackage{tikz}                    % TikZ for drawing
\usetikzlibrary{matrix,chains,positioning,decorations.pathreplacing,arrows,arrows.meta,calc}
\tikzset{>=latex}                    % Set default arrow style
\usepackage{tcolorbox}               % For colored/framed boxes, often with TikZ


% Page Layout
\usepackage[top=3cm, bottom=3cm, left=3cm, right=3cm, headheight=15pt]{geometry} % Page margins

% Chapter and Section Titles (fncychap and titlesec already loaded earlier)
\def\toclevel@subsubsubsection{4}    % Sub-sub-subsections in TOC
\def\l@subsubsubsection{\@dottedtocline{4}{7em}{4em}}
\setcounter{secnumdepth}{4}          % Numbering depth
\setcounter{tocdepth}{4}             % TOC depth

% Miscellaneous
\usepackage{pdflscape}               % Landscape support in PDF
\usepackage{footmisc}                % Footnote support
\usepackage[outline]{contour}        % Contour support for text
\contourlength{1.4pt}
\usepackage[normalem]{ulem}          % Underlining support
\usepackage{lipsum}                  % Lorem ipsum dummy text
\usepackage{bbding}                  % Dingbat symbols
\usepackage{dsfont}                  % For \mathds{1}
\usepackage{ifpdf}                   % Conditional compilation


% Document Title (usually set before \maketitle in the document body)
\title{Report_Template}

% Custom Commands
\newcommand{\challenge}[2]{
\vspace{1ex}
\textbf{Research task {#1}}: \emph{#2}
\vspace{1ex}}
\newcommand{\task}[2]{\challenge{#1}{#2}}
\newcommand{\taskref}[1]{\textbf{Task~}\ref{#1}}
\newcounter{tasknmbr}
\newcounter{tasklabel}
\renewcommand{\thetasklabel}{\textbf{\thetasknmbr}}
\newenvironment{taskenv}{
\begin{list}{\textbf{Task }\thetasklabel:}{\usecounter{tasklabel}\stepcounter{tasknmbr}\item\em}}{\\[-7pt]\end{list}}